body.dark-theme {
    --font-color: #eee;
    --dark-bg-1: #1f1f1f;
    --dark-bg-2: #232323;
    --dark-bg-3: #36393f;
    --dark-bg-4: #2c2f33;
    --dark-border-1: #bfbfbf;
    --link-color: #5da8ed;
    color: var(--font-color);
}

.dark-theme h1,
.dark-theme h2,
.dark-theme h3,
.dark-theme h4,
.dark-theme h5 {
    color: var(--font-color);
}

.dark-theme a:link,
.dark-theme a:visited,
.dark-theme a:active,
.dark-theme .toctogglelabel {
    color: var(--link-color);
}

.dark-theme a:hover {
    text-decoration: underline;
}

.dark-theme p {
    color: var(--font-color);
}

.dark-theme #view {
    background-color: #23272a;
}

.dark-theme .dropdown>li a:hover {
    background-color: rgba(0, 0, 0, 0.3);
}

.dark-theme #navigation .inner>ul>li.right a:hover {
    background-color: rgba(0, 0, 0, 0.3);
}

.dark-theme #navigation .inner>ul>li.search .input {
    background-color: rgba(0, 0, 0, 0.3);
}

.dark-theme #navigation,
.dark-theme #navigation .dropdown {
    background-color: var(--dark-bg-1); /* Sorry, but less colors go well with dark than light */
}

.dark-theme #footer {
    background-color: #202225;
    color: var(--font-color);
}

.dark-theme .box {
    background-color: var(--dark-bg-4);
    border-color: #000;
}

.dark-theme .box .box-header {
    background-color: var(--dark-bg-1);
    border-top-color: var(--dark-bg-1);
    border-bottom-color: #000;
}

.dark-theme .right .box .box-content {
    background-color: #2f3136;
}

.dark-theme #content {
    color: var(--font-color);
}

.dark-theme #content a.new, .dark-theme #content a.stub {
    color: #ef916c;
}

.dark-theme #content a.new:visited,
.dark-theme #content a.stub:visited {
    color: #aaaa00;
}

.dark-theme #content pre:not([class^="blocks"]),
.dark-theme #content code:not([class^="blocks"]) {
    border-color: var(--dark-bg-1);
    background: #23272a;
    color: var(--font-color);
}

.dark-theme #content h1,
.dark-theme #content h2 {
    border-bottom-color: var(--font-color);
}

.dark-theme #content a:visited {
    color: #339cff;
}

.dark-theme .mw-notification {
    background-color: var(--dark-bg-4);
    color: var(--font-color);
    border: 1px solid #fff;
}

.dark-theme textarea,
.dark-theme input,
.dark-theme select,
.dark-theme .mw-ui-button {
    background-color: var(--dark-bg-4);
    color: var(--font-color);
    border: 1px solid var(--dark-border-1);
}
.dark-theme textarea {
    border: 1px solid var(--dark-border-1) !important;
}
.dark-theme [class^="mw-widget-"],
.dark-theme [class*=" mw-widget-"] {
    background-color: var(--dark-bg-1);
    color: var(--font-color);
    border: 1px solid var(--dark-bg-4);
}
.dark-theme [class$="-handle"],
.dark-theme [class$="-input"]:not(.mw-input, .oo-ui-labelElement),
.dark-theme [class*="-handle "],
.dark-theme [class*="-input "]:not(.mw-input, .oo-ui-labelElement) {
    border: 1px solid var(--dark-border-1);
}
.dark-theme [class$="-disabled"] [class$="-handle"],
.dark-theme [class$="-disabled"] [class$="-input"]:not(.mw-input, .oo-ui-labelElement),
.dark-theme [class$="-disabled"] [class*="-handle "],
.dark-theme [class$="-disabled"] [class*="-input "]:not(.mw-input, .oo-ui-labelElement),
.dark-theme [class*="-disabled "] [class$="-handle"],
.dark-theme [class*="-disabled "] [class$="-input"]:not(.mw-input, .oo-ui-labelElement),
.dark-theme [class*="-disabled "] [class*="-handle "],
.dark-theme [class*="-disabled "] [class*="-input "]:not(.mw-input, .oo-ui-labelElement) {
    border-color: #000;
}
.dark-theme .editOptions {
    background-color: var(--dark-bg-3);
    border: 1px solid var(--dark-bg-1);
}

.dark-theme #mw-indicator-mw-helplink a {
    filter: invert(100%);
    color: #ff6930; /* hack to invert the black question mark */
}
.dark-theme .mw-plusminus-pos {
    color: #00bb00; /* lighten it cuz */
}
/* OOUI hacks */
.dark-theme .oo-ui-icon-search {
    filter: invert(1);
}
.dark-theme .oo-ui-inputWidget-input[type=search] {
    box-shadow: none;
}
.dark-theme .mw-search-profile-tabs {
    background-color: var(--dark-bg-1);
    border-color: var(--dark-border-1);
}

/* tables */
.dark-theme table.wikitable,
.dark-theme table.prettytable,
.dark-theme table.mw-datatable {
    background-color: var(--dark-bg-1);
    border-color: #666;
    color: var(--font-color);
}
.dark-theme table.mw-datatable td {
    background-color: transparent;
}
.dark-theme table.mw-datatable :hover td {
    background-color: rgba(255, 255, 255, 0.1) !important;
}
.dark-theme table.wikitable th,
.dark-theme table.wikitable td.h13,
.dark-theme table.wikitable th.h13,
.dark-theme table.prettytable th,
.dark-theme table.prettytable td.h13,
.dark-theme table.prettytable th.h13,
.dark-theme table.mw-datatable th,
.dark-theme table.mw-datatable td.h13,
.dark-theme table.mw-datatable th.h13 {
    background-color: #102448
}
.dark-theme table.wikitable th,
.dark-theme table.wikitable td,
.dark-theme table.prettytable th,
.dark-theme table.prettytable td,
.dark-theme table.mw-datatable th,
.dark-theme table.mw-datatable td {
    border-color: #666;
}

.dark-theme #mw-searchoptions {
    background-color: var(--dark-bg-1);
    border-color: #000;
}
.dark-theme .editOptions {
    color: var(--font-color);
}
.dark-theme #catlinks {
    background-color: var(--dark-bg-1);
    border-color: #000;
}
/* More OOUI hacks */
.dark-theme .oo-ui-buttonElement-framed.oo-ui-widget-enabled > .oo-ui-buttonElement-button {
    background-color: var(--dark-bg-1);
    color: var(--font-color);
    border-color: var(--dark-border-1);
}
.dark-theme .oo-ui-buttonElement-framed.oo-ui-widget-enabled.oo-ui-buttonElement-active > .oo-ui-buttonElement-button {
    background-color: #000;
    text-decoration: underline;
}
.dark-theme .oo-ui-buttonElement-framed.oo-ui-widget-enabled.oo-ui-flaggedElement-primary.oo-ui-flaggedElement-progressive > .oo-ui-buttonElement-button {
    background-color: #0645ad;
    border-color: #0645ad;
}
.dark-theme .oo-ui-dropdownWidget.oo-ui-widget-enabled.oo-ui-dropdownWidget-open .oo-ui-dropdownWidget-handle,
.dark-theme .oo-ui-dropdownWidget.oo-ui-widget-enabled .oo-ui-dropdownWidget-handle:hover {
    background-color: #000;
}
.dark-theme .oo-ui-dropdownWidget.oo-ui-widget-enabled .oo-ui-dropdownWidget-handle {
    background-color: var(--dark-bg-1);
    color: var(--font-color);
}
.dark-theme .oo-ui-tabSelectWidget-framed {
    background-color: #262626;
}
.dark-theme .oo-ui-tabOptionWidget {
    color: #ddd;
}
.dark-theme .oo-ui-tabSelectWidget-framed .oo-ui-tabOptionWidget.oo-ui-optionWidget-selected {
    background-color: #000;
    color: var(--font-color);
}
.dark-theme .mw-prefs-buttons {
    background-color: transparent;
}
.dark-theme .oo-ui-labelWidget.oo-ui-inline-help {
    color: #ccc;
}
.dark-theme .oo-ui-buttonElement-framed.oo-ui-widget-disabled > .oo-ui-buttonElement-button {
    background-color: transparent;
    border-color: rgba(0, 0, 0, 0.5);
}
.dark-theme .oo-ui-dropdownInputWidget.oo-ui-widget-enabled {
    background-color: transparent;
}
.dark-theme .oo-ui-dropdownInputWidget.oo-ui-widget-enabled select,
.dark-theme .oo-ui-dropdownInputWidget.oo-ui-widget-enabled input {
    background-color: var(--dark-bg-1);
    color: var(--font-color);
    border: 1px solid #000;
}
.dark-theme .oo-ui-menuSelectWidget {
    background-color: var(--dark-bg-1);
    color: var(--font-color);
}
.dark-theme .oo-ui-menuOptionWidget.oo-ui-widget-enabled.oo-ui-optionWidget {
    color: var(--font-color);
}
.dark-theme .oo-ui-menuOptionWidget.oo-ui-optionWidget-selected,
.dark-theme .oo-ui-menuOptionWidget.oo-ui-optionWidget-highlighted {
    background-color: rgba(255, 255, 255, 0.1);
}
.dark-theme .oo-ui-toolbar-bar {
    background-color: #000;
    color: var(--font-color);
}
.dark-theme .oo-ui-toolbar-bar [class$="-handle"],
.dark-theme .oo-ui-toolbar-bar [class$="-input"]:not(.mw-input),
.dark-theme .oo-ui-toolbar-bar [class*="-handle "],
.dark-theme .oo-ui-toolbar-bar [class*="-input "]:not(.mw-input) {
    border: none;
}
.dark-theme .oo-ui-barToolGroup-tools.oo-ui-toolGroup-disabled-tools .oo-ui-tool.oo-ui-flaggedElement-primary > .oo-ui-tool-link {
    background-color: var(--dark-bg-3);
}
.dark-theme .oo-ui-pendingElement-pending {
    background-color: var(--dark-bg-2);
    background-image: linear-gradient(135deg, #000 25%, transparent 25%, transparent 50%, #000 50%, #000 75%, transparent 75%, transparent);
    background-size: 1.42857143em 1.42857143em;
    animation: oo-ui-pendingElement-stripes 650ms linear infinite;
}
.dark-theme .oo-ui-windowManager-modal > .oo-ui-dialog > .oo-ui-window-frame,
.dark-theme .oo-ui-popupToolGroup.oo-ui-popupToolGroup-active > .oo-ui-popupToolGroup-handle {
    background-color: var(--dark-bg-1);
}
.dark-theme .oo-ui-toolbar-actions .oo-ui-popupToolGroup.oo-ui-widget-enabled > .oo-ui-popupToolGroup-handle:hover {
    border-right-color: #000;
}
.dark-theme .oo-ui-windowManager-modal > .oo-ui-dialog {
    background-color: rgba(0, 0, 0, 0.5);
}
.dark-theme .oo-ui-tool.oo-ui-widget-enabled > .oo-ui-tool-link:hover,
.dark-theme .oo-ui-tool.oo-ui-widget-enabled > .oo-ui-tool-link:active,
.dark-theme .oo-ui-listToolGroup-tools .oo-ui-tool.oo-ui-widget-enabled:hover,
.dark-theme .oo-ui-popupToolGroup.oo-ui-widget-enabled > .oo-ui-popupToolGroup-handle:hover,
.dark-theme .oo-ui-tool.oo-ui-widget-enabled.oo-ui-tool-active > .oo-ui-tool-link,
.dark-theme .oo-ui-tool.oo-ui-widget-enabled.oo-ui-popupToolGroup-active > .oo-ui-tool-link {
    background-color: var(--dark-bg-3);
    color: var(--font-color);
}
.dark-theme .oo-ui-indicator-down {
    filter: invert(1);
}
.dark-theme select.oo-ui-indicator-down {
    filter: none;
}
.dark-theme .oo-ui-popupToolGroup-tools {
    background-color: var(--dark-bg-1);
}
.dark-theme .oo-ui-popupToolGroup-tools .oo-ui-tool-active.oo-ui-widget-enabled .oo-ui-tool-link .oo-ui-tool-title {
    color: #c93;
}
.dark-theme .oo-ui-toggleSwitchWidget {
    background-color: var(--dark-bg-3);
    border-color: var(--dark-border-1);
}
.dark-theme .oo-ui-toggleSwitchWidget.oo-ui-widget-disabled {
    background-color: var(--dark-bg-1);
    border-color: var(--dark-bg-3);
}
.dark-theme .oo-ui-toggleSwitchWidget.oo-ui-widget-disabled .oo-ui-toggleSwitchWidget-grip {
    background-color: #f8f9fa;
}
.dark-theme .oo-ui-toggleSwitchWidget.oo-ui-widget-enabled:hover {
    background-color: #000;
}
.dark-theme .oo-ui-menuToolGroup {
    border-color: #000;
}
.dark-theme .mw-widget-mediaResultWidget .mw-widget-mediaResultWidget-overlay {
    background-color: unset; /* to counteract .dark-theme [class^="mw-widget-"] */
}
.dark-theme .oo-ui-selectFileWidget.oo-ui-widget-enabled.oo-ui-selectFileWidget-dropTarget {
    background-color: #000;
}
.dark-theme .mw-htmlform-ooui .mw-htmlform-matrix tbody tr:nth-child( even ) td {
    background-color: #000;
}
.dark-theme .mw-htmlform-ooui .mw-htmlform-matrix tbody tr:hover td {
    background-color: var(--dark-bg-3);
}
.dark-theme .oo-ui-textInputWidget.oo-ui-widget-disabled .oo-ui-inputWidget-input,
.dark-theme .oo-ui-textInputWidget.oo-ui-widget-enabled .oo-ui-inputWidget-input[readonly]:not( .oo-ui-pendingElement-pending ) {
    background-color: unset;
    border-color: #000;
    text-shadow: none;
}

/* Table of Contents fixes */
.dark-theme .toc {
    background-color: var(--dark-bg-1);
    border-color: #000;
}
.dark-theme .tocnumber {
    color: var(--font-color);
}

.dark-theme .diff-context {
    background-color: var(--dark-bg-1);
    border-color: #000;
    color: var(--font-color);
}
.dark-theme .diff-addedline {
    background-color: var(--dark-bg-1);
    border-color: #859900;
}
.dark-theme .diff-deletedline {
    background-color: var(--dark-bg-1);
    border-color: #dc322f;
}
.dark-theme [class^="diff"] .diffchange,
.dark-theme .diffchange {
    background-color: unset;
    border: 1px solid #aaa;
}

.dark-theme #filetoc {
    background-color: var(--dark-bg-1);
    border-color: #000;
}

/* Fix image thumbnails */
.dark-theme .thumbimage {
    background-color: unset;
    border-color: #8b8174;
}
.dark-theme figure[typeof],
.dark-theme figure[typeof] > figcaption,
.dark-theme div.thumbinner {
    background-color: #070605;
    color: var(--font-color);
}

/* Fix recent changes */
.dark-theme .oo-ui-tagMultiselectWidget,
.dark-theme .oo-ui-tagMultiselectWidget.oo-ui-widget-enabled,
.dark-theme .oo-ui-tagMultiselectWidget.oo-ui-widget-enabled.oo-ui-tagMultiselectWidget-outlined,
.dark-theme .mw-rcfilters-ui-filterTagMultiselectWidget.oo-ui-widget-enabled .oo-ui-tagMultiselectWidget-handle,
.dark-theme .mw-rcfilters-ui-filterMenuOptionWidget.oo-ui-flaggedElement-muted:not( .oo-ui-optionWidget-selected ),
.dark-theme .mw-rcfilters-ui-filterMenuHeaderWidget-header,
.dark-theme .mw-rcfilters-ui-menuSelectWidget-footer,
.dark-theme .oo-ui-popupWidget-popup {
    background-color: var(--dark-bg-1);
}
.dark-theme .oo-ui-labelWidget,
.dark-theme .mw-rcfilters-ui-itemMenuOptionWidget-label-desc,
.dark-theme .oo-ui-labelElement-label,
.dark-theme .mw-rcfilters-ui-filterMenuSectionOptionWidget-header-title.oo-ui-labelElement-label,
.dark-theme .mw-rcfilters-ui-viewSwitchWidget label.oo-ui-labelWidget {
    color: var(--font-color);
}
.dark-theme .oo-ui-iconElement-icon {
    filter: invert(1);
}
.dark-theme .oo-ui-textInputWidget .oo-ui-inputWidget-input,
.dark-theme .oo-ui-tagMultiselectWidget.oo-ui-widget-enabled.oo-ui-tagMultiselectWidget-outlined .oo-ui-tagItemWidget.oo-ui-widget-enabled,
.dark-theme .mw-rcfilters-ui-filterMenuSectionOptionWidget {
    background-color: var(--dark-bg-1);
    color: var(--font-color);
}
.dark-theme .mw-changeslist-legend,
.dark-theme .mw-rcfilters-ui-changesListWrapperWidget .mw-changeslist-legend {
    background-color: unset;
}
.dark-theme .mw-rcfilters-ui-filterMenuOptionWidget.oo-ui-flaggedElement-muted.oo-ui-optionWidget-highlighted {
    background-color: var(--dark-bg-2);
}
.dark-theme .mw-rcfilters-ui-filterMenuOptionWidget.oo-ui-flaggedElement-muted .mw-rcfilters-ui-itemMenuOptionWidget-label-desc {
    color: #ddd;
}
.dark-theme .oo-ui-buttonElement-framed.oo-ui-widget-enabled > .oo-ui-buttonElement-button:hover {
    color: #fff;
    background-color: var(--dark-bg-2);
}
.dark-theme .mw-rcfilters-ui-filterTagMultiselectWidget-views-input:not(.mw-input),
.dark-theme .mw-rcfilters-ui-filterTagMultiselectWidget-views-input:not(.mw-input) .oo-ui-inputWidget-input {
    border: none;
}

/* Fix editing */
.dark-theme .wikiEditor-ui-toolbar {
    background-color: var(--dark-bg-1);
}
.dark-theme .wikiEditor-ui-toolbar .group .tool-select .options {
    background-color: var(--dark-bg-1);
    color: var(--font-color);
}
.dark-theme .ui-widget-content {
    background: var(--dark-bg-3);
    color: var(--font-color);
}
.dark-theme .wikiEditor-ui-toolbar .tabs span.tab a {
    color: var(--link-color);
}
.dark-theme .wikiEditor-ui-toolbar .group .tool-select .options .option {
    color: var(--font-color);
}
.dark-theme .wikiEditor-ui-toolbar .tabs span.tab a.current,
.dark-theme .wikiEditor-ui-toolbar .tabs span.tab a.current:visited,
.dark-theme .wikiEditor-ui-toolbar .group .tool-select .label {
    color: #ddd;
}
.dark-theme .wikiEditor-ui-toolbar .group .label {
    color: #afaaa7;
}
.dark-theme .ui-widget-header {
    background: var(--dark-bg-2);
    color: var(--font-color);
}
.dark-theme .ui-state-default,
.dark-theme .ui-widget-content .ui-state-default,
.dark-theme .ui-widget-header .ui-state-default {
    background: var(--dark-bg-1);
    border-color: var(--dark-bg-1);
    color: var(--font-color);
}
.dark-theme .wikiEditor-ui .wikiEditor-ui-top,
.dark-theme .wikiEditor-ui-toolbar .group,
.dark-theme .wikiEditor-ui .wikiEditor-ui-view,
.dark-theme .wikiEditor-ui-toolbar .sections .section {
    border-color: var(--dark-border-1);
}
.dark-theme .wikiEditor-ui-toolbar .page-characters div span,
.dark-theme .wikiEditor-ui-toolbar .page-table th,
.dark-theme .wikiEditor-ui-toolbar .page-table td {
    color: var(--font-color);
}

/* CodeMirror fixes */
.dark-theme .CodeMirror {
    background-color: var(--dark-bg-4);
}
.dark-theme .CodeMirror ::selection {
    color: var(--dark-bg-4);
}
.dark-theme .CodeMirror .CodeMirror-gutters {
    background-color: var(--dark-bg-1);
    border-right-color: var(--dark-border-1);
}
.dark-theme .CodeMirror .cm-mw-extlink-protocol,
.dark-theme .CodeMirror .cm-mw-free-extlink-protocol,
.dark-theme .CodeMirror .cm-mw-extlink,
.dark-theme .CodeMirror .cm-mw-free-extlink,
.dark-theme .CodeMirror .cm-mw-extlink-bracket,
.dark-theme .CodeMirror .cm-mw-link-pagename,
.dark-theme .CodeMirror .cm-mw-link-bracket,
.dark-theme .CodeMirror .cm-mw-link-tosection,
.dark-theme .CodeMirror .cm-mw-link-delimiter {
    color: var(--link-color);
}
.dark-theme .CodeMirror .cm-mw-link {
    color: var(--font-color);
}
.dark-theme .CodeMirror .cm-mw-htmltag-name,
.dark-theme .CodeMirror .cm-mw-htmltag-bracket,
.dark-theme .CodeMirror .cm-mw-htmltag-attribute,
.dark-theme .CodeMirror .cm-mw-mnemonic,
.dark-theme .CodeMirror .cm-mw-exttag-name,
.dark-theme .CodeMirror .cm-mw-exttag-bracket,
.dark-theme .CodeMirror .cm-mw-exttag-attribute {
    color: #32e600;
}
.dark-theme .CodeMirror .cm-mw-apostrophes-bold,
.dark-theme .CodeMirror .cm-mw-apostrophes-italic {
    color: #80c4ff;
}
.dark-theme .CodeMirror .cm-mw-template-name,
.dark-theme .CodeMirror .cm-mw-template-bracket,
.dark-theme .CodeMirror .cm-mw-template-delimiter {
    color: #b31aff;
}
.dark-theme .CodeMirror .cm-mw-template,
.dark-theme .CodeMirror .cm-mw-template-argument-name {
    color: #d580ff;
}
.dark-theme .CodeMirror .cm-mw-parserfunction-name,
.dark-theme .CodeMirror .cm-mw-parserfunction-bracket {
    color: #e81717;
}
.dark-theme .CodeMirror .cm-mw-doubleUnderscore,
.dark-theme .CodeMirror .cm-mw-signature,
.dark-theme .CodeMirror .cm-mw-hr {
    color: var(--link-color);
    background-color: var(--dark-bg-3);
}

/* SyntaxHighlight fixes */

.dark-theme #content pre[class*="language-"],
.dark-theme #content code[class*="language-"] {
    background: #1d1f21;
    text-shadow: none;
    filter: saturate(2);
}

.dark-theme .mw-syntaxhighlight .keyword,
.dark-theme .mw-syntaxhighlight .builtin {
    color: #0f0;
}
.dark-theme .mw-syntaxhighlight .function {
    color: #f0f;
}
.dark-theme .mw-syntaxhighlight .operator {
    color: #999;
    background: none;
}
.dark-theme .mw-syntaxhighlight .comment {
    color: #52a3a3;
}
.dark-theme .mw-syntaxhighlight .string {
    color: #e46767;
}
.dark-theme .mw-syntaxhighlight .deleted {
    color: #ff4d4d;
}
.dark-theme .mw-syntaxhighlight .inserted {
    color: #4dff4d;
}
.dark-theme .mw-syntaxhighlight .unchanged {
    color: #f0f;
}

/* RecentChanges banner fixes */
.dark-theme .mw-scratch-confirmaccount-rc-awaiting,
.dark-theme .mw-reoprt-reports-awaiting {
    background-color: #060606;
    color: #fff;
}

/* Box fixes */

.dark-theme .mw-message-box,
.dark-theme .messagebox,
.dark-theme .mw-message-box-error,
.dark-theme .errorbox,
.dark-theme .mw-message-box-warning,
.dark-theme .warningbox,
.dark-theme .mw-message-box-success,
.dark-theme .successbox {
    color: unset;
}
.dark-theme .mw-message-box,
.dark-theme .messagebox {
    background-color: rgb(34, 37, 38);
    border-color: rgb(72, 78, 81);
}
.dark-theme .mw-message-box-error,
.dark-theme .errorbox {
    background-color: rgb(64, 5, 3);
    border-color: rgb(149, 25, 25);
}
.dark-theme .mw-message-box-warning,
.dark-theme .warningbox {
    background-color: rgb(63, 42, 3);
    border-color: rgb(163, 122, 0);
}
.dark-theme .mw-message-box-success,
.dark-theme .successbox {
    background-color: rgb(4, 74, 62);
    border-color: rgb(27, 182, 148);
}

/* Page preview fixes */
.dark-theme .mwe-popups {
    background: #181a1b;
}
.dark-theme .mwe-popups.flipped-y:after,
.dark-theme .mwe-popups.mwe-popups-no-image-pointer:after,
.dark-theme .mwe-popups.flipped-y:before,
.dark-theme .mwe-popups.mwe-popups-no-image-pointer:before {
    border-top-color: #181a1b;
    border-bottom-color: #181a1b;
}
.dark-theme .mwe-popups *,
.dark-theme .mwe-popups a.mwe-popups-extract,
.dark-theme .mwe-popups a.mwe-popups-extract:link {
    color: #dfdedd;
}
.dark-theme .mwe-popups .mwe-popups-extract[dir='ltr']:after,
.dark-theme .mwe-popups .mwe-popups-extract[dir='rtl']:after {
    background: none;
}
.dark-theme #content .previewnote p {
    color: #ffa2a2;
}

/* File: page metadata fixes */
.dark-theme .mw_metadata th {
    background-color: var(--dark-bg-2);
}
.dark-theme .mw_metadata td {
    background-color: var(--dark-bg-1);
}
.dark-theme .mw_metadata td, .dark-theme .mw_metadata th {
    border-color: var(--dark-bg-3);
}

/* Visual Editor-specific (non-OOUI) fixes */
.dark-theme .ve-activated #catlinks:hover {
    background-color: var(--dark-bg-1);
}
.dark-theme .ve-ce-branchNode-blockSlug,
.dark-theme .ve-ce-branchNode-newSlug {
    background-color: rgba(29, 32, 33, 0.75);
}
.dark-theme .ve-ui-mwSaveDialog-options {
    background-color: unset;
}
.dark-theme .ve-ui-mwSaveDialog-summary {
    background-color: unset;
    border: 1px solid #fff;
}
.dark-theme .ve-ui-targetWidget:not(.oo-ui-pendingElement-pending) {
    background-color: #000;
}
.dark-theme .ve-ui-mwGalleryDialog-highlighted-image {
    background-color: var(--dark-bg-1);
}

/* Fix history page */
.dark-theme #pagehistory li.selected {
    background-color: var(--dark-bg-1);
    color: var(--font-color);
}

/* Fix search suggestions */
.dark-theme .suggestions-results,
.dark-theme .suggestions-special {
    background-color: var(--dark-bg-1);
    border-color: var(--dark-border-1);
}
.dark-theme .suggestions a.mw-searchSuggest-link,
.dark-theme .suggestions a.mw-searchSuggest-link:hover,
.dark-theme .suggestions a.mw-searchSuggest-link:active,
.dark-theme .suggestions a.mw-searchSuggest-link:focus,
.dark-theme .suggestions-result,
.dark-theme .suggestions-special .special-query {
    color: var(--font-color);
}

/* Fix math */
.dark-theme .mwe-math-fallback-image-inline {
    filter: invert(1);
}

/* Fix Special:Preferences */
.dark-theme #wpTimeCorrection {
    background-color: transparent;
}

/* Fix Echo */
.dark-theme .mw-echo-ui-notificationsInboxWidget-toolbarWrapper {
    background-color: unset;
}
.dark-theme .mw-echo-ui-notificationItemWidget {
    background-color: var(--dark-bg-2);
}
.dark-theme .mw-echo-ui-notificationItemWidget:hover {
    background-color: var(--dark-bg-4);
}
.dark-theme .mw-echo-ui-notificationItemWidget-unread {
    background-color: #000;
}
.dark-theme .mw-echo-ui-notificationItemWidget-unread:hover {
    background-color: var(--dark-bg-1);
}
.dark-theme .mw-echo-ui-notificationItemWidget-content-message-header,
.dark-theme .mw-echo-ui-notificationItemWidget-content-message-body {
    color: var(--font-color);
}
.dark-theme .mw-echo-ui-pageNotificationsOptionWidget.oo-ui-optionWidget-selected {
    background-color: var(--dark-bg-1);
}
.dark-theme .mw-echo-ui-pageNotificationsOptionWidget-label-count {
    background-color: var(--dark-bg-2);
}
.dark-theme .mw-echo-ui-pageNotificationsOptionWidget.oo-ui-optionWidget-selected.mw-echo-ui-pageNotificationsOptionWidget.oo-ui-optionWidget-highlighted,
.dark-theme .mw-echo-ui-pageNotificationsOptionWidget.oo-ui-optionWidget-pressed.mw-echo-ui-pageNotificationsOptionWidget.oo-ui-optionWidget-highlighted {
    background-color: rgba(33, 78, 163, 0.1);
}
.dark-theme .mw-echo-ui-pageNotificationsOptionWidget.oo-ui-optionWidget-highlighted {
    background-color: var(--dark-bg-2);
    color: var(--font-color);
}
.dark-theme .mw-echo-ui-menuItemWidget > .oo-ui-buttonElement-button > .oo-ui-labelElement-label {
    color: var(--font-color);
}
.dark-theme .mw-echo-special-nojs {
    filter: invert(1); /* doesn't look great but it works */
}

/* Fix references */
.dark-theme ol.references li:target,
.dark-theme sup.reference:target {
    background-color: #000;
}
.dark-theme #content sup.reference:target a,
.dark-theme #content sup.reference:target a:visited {
    color: #cc0;
}
